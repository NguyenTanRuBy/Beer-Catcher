{"version":3,"sources":["GameManager.js"],"names":["Player","require","newBeerBottles","brokenBottle","cc","Class","extends","Component","properties","player","default","type","beerBottlePrefab","Prefab","canvas","Canvas","btnPlay","Button","btnRetry","btnMenu","scoreLabel","Label","isPlaying","isOver","score","onLoad","node","getChildByName","active","find","spawnNewBeerBottle","newBeerBottle","instantiate","addChild","setPosition","getNewBeerPosition","push","clickPlayButton","resetStatus","clickRetryButton","clickMenuButton","maxX","width","randX","Math","random","randY","height","v2","getDistance","node1","node2","newX","x","newY","y","sqrt","abs","pow","gainScore","string","start","timer","update","dt","console","log","getPosition","forEach","element","shift","destroy","widthLimit","childrenCount"],"mappings":"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","file":"GameManager.js","sourceRoot":"..\\..\\..\\..\\assets\\Scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\r\n\r\nvar Player = require(\"Player\");\r\nvar newBeerBottles = [];\r\nvar brokenBottle = 0;\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n        player: {\r\n            default: null,\r\n            type: Player\r\n        },\r\n\r\n        beerBottlePrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n\r\n        canvas: {\r\n            default: null,\r\n            type: cc.Canvas\r\n        },\r\n\r\n        btnPlay: {\r\n            default: null,\r\n            type: cc.Button\r\n        },\r\n\r\n        btnRetry: {\r\n            default: null,\r\n            type: cc.Button\r\n        },\r\n\r\n        btnMenu: {\r\n            default: null,\r\n            type: cc.Button\r\n        },\r\n\r\n        scoreLabel: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n\r\n        isPlaying: false,\r\n        isOver: false,\r\n        brokenBottle: 0,\r\n        score: 0\r\n\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n        //de-active chaibia node\r\n        this.canvas.node.getChildByName(\"chaibia\").active = false;\r\n        //de-active game over panel\r\n        cc.find(\"GUI/GameOver\", this.node).active = false;\r\n    },\r\n\r\n    spawnNewBeerBottle: function ()\r\n    {\r\n        //generate new beer bottle\r\n        var newBeerBottle = cc.instantiate(this.beerBottlePrefab);\r\n\r\n        //add beer bottle to canvas\r\n        this.canvas.node.addChild(newBeerBottle);\r\n        newBeerBottle.setPosition(this.getNewBeerPosition());\r\n        newBeerBottles.push(newBeerBottle);\r\n\r\n    },\r\n\r\n    clickPlayButton: function ()\r\n    {\r\n        if (this.isOver == true) {\r\n            this.resetStatus();\r\n            this.isPlaying = true;\r\n        }\r\n        else {\r\n            cc.find(\"GUI/MainMenu\", this.node).active = false;\r\n            cc.find(\"GUI/GameOver\", this.node).active = false;\r\n            this.isPlaying = true;\r\n        }\r\n\r\n    },\r\n\r\n    clickRetryButton: function ()\r\n    {\r\n        cc.find(\"GUI/GameOver\", this.node).active = false;\r\n        this.resetStatus();\r\n        this.isPlaying = true;\r\n    },\r\n\r\n    clickMenuButton: function ()\r\n    {\r\n        cc.find(\"GUI/GameOver\", this.node).active = false;\r\n        cc.find(\"GUI/MainMenu\", this.node).active = true;\r\n        this.resetStatus();\r\n    },\r\n\r\n    resetStatus: function ()\r\n    {\r\n        brokenBottle = 0;\r\n        this.isOver = false;\r\n        this.score = 0;\r\n    },\r\n\r\n    getNewBeerPosition: function ()\r\n    {\r\n       var maxX = this.canvas.node.width / 2;\r\n       var randX = (Math.random() - 0.5) * 2 * maxX;\r\n       var randY = this.canvas.node.height / 2 - 100;\r\n        return cc.v2(randX, randY);\r\n    },\r\n\r\n    getDistance: function (node1, node2)\r\n    {\r\n        var newX = node2.x - node1.x;\r\n        var newY = node2.y - node1.y;\r\n\r\n        return Math.sqrt(Math.abs(Math.pow(newX, 2) + Math.pow(newY, 2)));\r\n    },\r\n\r\n    gainScore: function () {\r\n        this.score += 1;\r\n        this.scoreLabel.string = 'Score: ' + this.score;\r\n    },\r\n\r\n    start() {\r\n        this.timer = 0;\r\n    },\r\n\r\n    update(dt) {\r\n        if (this.isPlaying)\r\n        {\r\n            // time to respawn bottle\r\n            if (this.timer <= 4.5) {\r\n                this.timer += dt;\r\n            }\r\n            else {\r\n\r\n                this.spawnNewBeerBottle();\r\n                this.timer = 0;\r\n                console.log(this.getNewBeerPosition());\r\n                console.log(\"player: \" + this.player.node.getPosition());\r\n            }\r\n            //update score\r\n            this.scoreLabel.string = \"Score: \" + this.score;\r\n\r\n            //collide with each beer prefab\r\n            newBeerBottles.forEach(element => {\r\n                ///colected beerbottle\r\n                if (this.getDistance(this.player.node, element) <= 60)\r\n                {\r\n                    this.gainScore();\r\n                    newBeerBottles.shift();\r\n                    element.destroy();\r\n                } // broken bottle\r\n                else if (element.y < -270) {\r\n                    newBeerBottles.shift();\r\n                    element.destroy();\r\n                    brokenBottle += 1;\r\n\r\n                    if (brokenBottle >= 3) {\r\n                        this.isPlaying = false;\r\n                        this.isOver = true;\r\n                    }\r\n                }\r\n            });\r\n\r\n            //if player out of box => lose\r\n            var widthLimit = this.canvas.width / 2 + 20;\r\n\r\n            if (this.player.node.x > widthLimit || this.player.x < -widthLimit) {\r\n                this.isPlaying = false;\r\n                this.isOver = true;\r\n                console.log(\"cc\");\r\n            }\r\n\r\n            console.log(\"broken bottle : \" + brokenBottle);\r\n            console.log(\"number of children in canvas: \" + this.canvas.node.childrenCount);\r\n            newBeerBottles.forEach(element => {\r\n                console.log(\"dis: \" + this.getDistance(this.player.node, element));\r\n                console.log();\r\n            });\r\n\r\n        }\r\n        else if (this.isOver)\r\n        {\r\n            cc.find(\"GUI/GameOver\", this.node).active = true;\r\n\r\n        }\r\n    },\r\n\r\n});\r\n"]}